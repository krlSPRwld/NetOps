# Homework NO. 3: Data Models - Create a Service Data Model

This repository contains sources for excercises generated during the
[Network Automation workshop](http://www.ipspace.net/NetAutWS)

## What is to be solved with that

What I try to solve with this data model is the initial setup of a data center fabric with numbering of the fabric connecting interfaces, the numbering of loopback interfaces, and selecting the right BGP autonomous system number for each machine participating in the fabric according to its role. I tried to solve this by defining some group specific variables in [group_vars/all.yml](group_vars/all.yml). Here we have some prefixes (not network prefixes in its common understanding, but prefixes to be automaticaly extended during provisioning), as the digits prepended to the AS number, the IPv6 part which prepends the network addresses and so on. Just take a look at the yaml file, I think it would be self explaining.

In addition to the gorup_vars, I only use the host inventory in [hosts](hosts) and try to get all the information needed from the hostnames, e.g. r1.hallowe.en has the information "r", which is used in the template to determine a spine system, and "1", for the first system of that type.

All the rest will be calculated from the host count of the specific type. Output will be the "facts" generated, not a valid configuration file or something. But, for demonstation purpose, this should hopefully be enough.

See this small sketch for a better understanding on how the fabric is inteded to be set up and numbered: [DC-Layout](DC-Layout.jpg)

## Subdirectories 
* templates: contains jinja2 template for generating the addressing for each host.
* initial-config: contains output generated by playbook [prepare-fabric.yml](prepare-fabric.yml)

## How to run this

The playbook is run from the parent Ansible directory with the following command: "ansible-playbook Homework-3/prepare-fabric.yml".

## What it does

The playbook just empties the directory initial-config in which the information would be published later on. Next it would call a template to be written for each host. In this template, ther is all the logic put together, the prefixes defined in group_vars/all.yml the host information derived from inventory_host variable and some calculations to have the count of spines and leaves or do the right numbering. Take a look at the template [fabric-template.j2](templates/fabric-template.j2)

Feel free to explore, modify and reuse! 
